name: AuthZen Interop
model: |+
    model
      schema 1.1

    type user
      relations
        define can_read_user: can_view_users from todo
        define linked_user: [user]
        define me: [user]
        define todo: [todo]
        define user_or_linked_user: me or linked_user

    type todo
      relations
        define parent: [todo]

        # This is set as a contextual tuple. It's required to pass the 
        define OwnerID: [user]
        define can_create_todo: editor_role or evil_genius_role or admin_role or can_create_todo from parent
        define can_delete_todo: (editor_role from parent and owner_role) or admin_role from parent
        define can_read_todos: viewer_role or editor_role or evil_genius_role or admin_role
        define can_update_todo: (editor_role from parent and owner_role) or evil_genius_role from parent

        define can_view_users: user_viewer
        
        define admin: [user]
        define admin_role: user_or_linked_user from admin

        define editor: [user]
        define editor_role: user_or_linked_user from editor or admin_role or evil_genius

        define evil_genius: [user]
        define evil_genius_role: user_or_linked_user from evil_genius 

        define owner: [user]
        define owner_role: user_or_linked_user from owner or user_or_linked_user from OwnerID

        define user_viewer: [user:*]
        define viewer: [user]
        define viewer_role: user_or_linked_user from viewer or editor

tuples:
    - user: user:*
      relation: user_viewer
      object: todo:todo-1

    # Linking users to themselves

    - user: user:CiRmZDA2MTRkMy1jMzlhLTQ3ODEtYjdiZC04Yjk2ZjVhNTEwMGQSBWxvY2Fs
      relation: me
      object: user:CiRmZDA2MTRkMy1jMzlhLTQ3ODEtYjdiZC04Yjk2ZjVhNTEwMGQSBWxvY2Fs
    - user: user:CiRmZDM2MTRkMy1jMzlhLTQ3ODEtYjdiZC04Yjk2ZjVhNTEwMGQSBWxvY2Fs
      relation: me
      object: user:CiRmZDM2MTRkMy1jMzlhLTQ3ODEtYjdiZC04Yjk2ZjVhNTEwMGQSBWxvY2Fs
    - user: user:CiRmZDE2MTRkMy1jMzlhLTQ3ODEtYjdiZC04Yjk2ZjVhNTEwMGQSBWxvY2Fs
      relation: me
      object: user:CiRmZDE2MTRkMy1jMzlhLTQ3ODEtYjdiZC04Yjk2ZjVhNTEwMGQSBWxvY2Fs
    - user: user:CiRmZDI2MTRkMy1jMzlhLTQ3ODEtYjdiZC04Yjk2ZjVhNTEwMGQSBWxvY2Fs
      relation: me
      object: user:CiRmZDI2MTRkMy1jMzlhLTQ3ODEtYjdiZC04Yjk2ZjVhNTEwMGQSBWxvY2Fs
    - user: user:CiRmZDQ2MTRkMy1jMzlhLTQ3ODEtYjdiZC04Yjk2ZjVhNTEwMGQSBWxvY2Fs
      relation: me
      object: user:CiRmZDQ2MTRkMy1jMzlhLTQ3ODEtYjdiZC04Yjk2ZjVhNTEwMGQSBWxvY2Fs
    
    # Linking user IDs and Emails
    - user: user:CiRmZDQ2MTRkMy1jMzlhLTQ3ODEtYjdiZC04Yjk2ZjVhNTEwMGQSBWxvY2Fs
      relation: linked_user
      object: user:jerry@the-smiths.com
    - user: user:CiRmZDI2MTRkMy1jMzlhLTQ3ODEtYjdiZC04Yjk2ZjVhNTEwMGQSBWxvY2Fs
      relation: linked_user
      object: user:summer@the-smiths.com
    - user: user:CiRmZDE2MTRkMy1jMzlhLTQ3ODEtYjdiZC04Yjk2ZjVhNTEwMGQSBWxvY2Fs
      relation: linked_user
      object: user:morty@the-citadel.com
    - user: user:CiRmZDM2MTRkMy1jMzlhLTQ3ODEtYjdiZC04Yjk2ZjVhNTEwMGQSBWxvY2Fs
      relation: linked_user
      object: user:beth@the-smiths.com
    - user: user:CiRmZDA2MTRkMy1jMzlhLTQ3ODEtYjdiZC04Yjk2ZjVhNTEwMGQSBWxvY2Fs
      relation: linked_user
      object: user:rick@the-citadel.com
      
    # Relating all users to the root todo ('the todo app')
    - user: todo:todo-1
      relation: todo
      object: user:morty@the-citadel.com
    - user: todo:todo-1
      relation: todo
      object: user:beth@the-smiths.com
    - user: todo:todo-1
      relation: todo
      object: user:summer@the-smiths.com
    - user: todo:todo-1
      relation: todo
      object: user:rick@the-citadel.com
    - user: todo:todo-1
      relation: todo
      object: user:jerry@the-smiths.com

    # Rick 
    - user: user:CiRmZDA2MTRkMy1jMzlhLTQ3ODEtYjdiZC04Yjk2ZjVhNTEwMGQSBWxvY2Fs
      relation: admin
      object: todo:todo-1
    - user: user:CiRmZDA2MTRkMy1jMzlhLTQ3ODEtYjdiZC04Yjk2ZjVhNTEwMGQSBWxvY2Fs
      relation: evil_genius
      object: todo:todo-1
    # Beth
    - user: user:CiRmZDM2MTRkMy1jMzlhLTQ3ODEtYjdiZC04Yjk2ZjVhNTEwMGQSBWxvY2Fs
      relation: viewer
      object: todo:todo-1
    # Morty
    - user: user:CiRmZDE2MTRkMy1jMzlhLTQ3ODEtYjdiZC04Yjk2ZjVhNTEwMGQSBWxvY2Fs
      relation: editor
      object: todo:todo-1
    # Summer
    - user: user:CiRmZDI2MTRkMy1jMzlhLTQ3ODEtYjdiZC04Yjk2ZjVhNTEwMGQSBWxvY2Fs
      relation: editor
      object: todo:todo-1
    # Jerry
    - user: user:CiRmZDQ2MTRkMy1jMzlhLTQ3ODEtYjdiZC04Yjk2ZjVhNTEwMGQSBWxvY2Fs
      relation: viewer
      object: todo:todo-1

tests:
    - name: Tests
      check: []

